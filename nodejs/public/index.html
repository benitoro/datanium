<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Datanium - Play with Data</title>
<meta name="author" content="Datanium" />
<link rel="shortcut icon" href="./img/favicon32.ico">
<link rel="stylesheet" type="text/css" href="./css/normalize.css">
<link rel="stylesheet" type="text/css" href="./css/demo.css" />
<link rel="stylesheet" type="text/css" href="./css/component.css" />
<link rel="stylesheet" href="./js/extjs/resources/css/ext-all-gray-debug.css">
<link rel="stylesheet" href="./css/font-awesome/css/font-awesome.min.css">
<link rel="stylesheet" type="text/css" href="./css/datanium.css">
<link rel="stylesheet" type="text/css" href="./js/bootstrap/css/bootstrap.css">
<script>
	var console = console || {
		"log" : function() {
		}
	};
</script>
<script type="text/javascript" src="./js/extjs/ext-all.js"></script>
<script type="text/javascript" src="./js/app/util/CommonUtils.js"></script>
<script type="text/javascript" src="./js/app/util/GlobalData.js"></script>
<script type="text/javascript" src="./js/app/app.js"></script>
<script type="text/javascript" src="./js/jquery/jquery-1.9.1.min.js"></script>
<script type="text/javascript" src="./js/bootstrap/js/bootstrap.min.js"></script>

</head>
<body>
	<div class="custom-container">
		<ul id="gn-menu" class="gn-menu-main">
			<li class="gn-trigger"><a class="gn-icon gn-icon-menu"><span>Menu</span></a>
				<nav class="gn-menu-wrapper">
					<div class="gn-scroller">
						<ul class="gn-menu">
							<li class="gn-search-item"><input placeholder="Search" type="search" class="gn-search"
								id="gnsearch"> <a class="gn-icon gn-icon-search"><span>Search</span></a></li>
							<li><a href="#" class="gn-icon gn-icon-article" data-toggle="modal"
								onclick="showModal();">By Topic</a>
							<li><a class="gn-icon gn-icon-earth" onclick="comingSoon();">By Country</a></li>
							<li><a class="gn-icon gn-icon-archive" onclick="comingSoon();">By Data Source</a></li>
							<li><a class="gn-icon gn-icon-help" onclick="comingSoon();">About Data</a></li>
						</ul>
					</div>
					<!-- /gn-scroller -->
				</nav></li>
			<li><a href="#" onclick="save();"><span><i class="fa fa-pencil-square-o"></i>&nbsp;Save</span></a></li>
			<li><a href="#" onclick="comingSoon();"><span><i class="fa fa-laptop"></i>&nbsp;Space</span></a></li>
			<li><a href="#" onclick="comingSoon();"><span><i class="fa fa-comment-o"></i>&nbsp;Feedback</span></a></li>
			<li><a href="#" onclick="about();"><span><i class="fa fa-smile-o"></i>&nbsp;About</span></a></li>

			<li><a id="userLink" href="#" onclick="loginpop();"><span><i class="fa fa-user"></i><span
						id="userLabel">&nbsp;Login/Sign up</span></span></a></li>
		</ul>
		<header>
			<h1>
				Datanium Prototype <span>An online public data analysis tool as seen on the <a
					href="https://github.com/datanium/datanium">Github</a> page
				</span>
			</h1>
		</header>
		<div id="appContainer"></div>
	</div>

	<div class="modal fade" id="txtmodal" style="z-index: 1000000">
		<div class="modal-dialog" id="txtmodaldialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h5 class="modal-title" id="txtmodaltitle"></h5>
				</div>
				<div class="modal-body">
					<h4 id="txtmodalbody"></h4>
					<div id="txtmodalhtmlbody"></div>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="ieversion" style="z-index: 1000000">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h5 class="modal-title">Browser Support</h5>
				</div>
				<div class="modal-body">
					<h4>You are using an old version browser.</h4>
					<span>This site has been developed and optimized for the following browsers:<br /></span> <span><a
						href="http://www.google.com/intl/en-US/chrome/browser/" target="_blank">Google Chrome 3+</a><br /></span>
					<span><a href="http://www.mozilla.com/en-US/firefox/" target="_blank">Mozilla
							Firefox 4+</a><br /></span> <span><a
						href="http://www.microsoft.com/en-us/download/internet-explorer.aspx" target="_blank">Internet
							Explorer 9+</a><br /></span> <span><a href="http://www.apple.com/safari/download/"
						target="_blank">Apple Safari 4+</a><br /></span> <span>If you are using an older version or
						different browser that is having difficulty rendering this site, download and install the
						latest version of your browser using the link above.</span>
					<p></p>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="loginModal" style="z-index: 1000000">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Login</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal" role="form">
						<div class="form-group">
							<div class="col-sm-offset-1 col-sm-10">
								<label id="emailLabel" for="inputEmail" class="val_error_label"></label> <input type="email"
									class="form-control" id="inputEmail" placeholder="Email" />
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-1 col-sm-10">
								<label id="passwordLabel" for="inputPassword" class="val_error_label"></label> <input
									type="password" class="form-control" id="inputPassword" placeholder="Password" />
							</div>
						</div>
						<div class="col-sm-offset-1 col-sm-10">
							<div class="login_foot">
								<label> <a href="#" onclick="signuppop();">Sign up</a>
								</label>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-primary" onclick="login();">Login</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="signupModal" style="z-index: 1000000">
		<div class="modal-dialog modal-sm">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h4 class="modal-title">Sign up</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal" role="form">
						<div class="form-group">
							<div class="col-sm-offset-1 col-sm-10">
								<label id="emailLabel2" for="inputEmail2" class="val_error_label"></label> <input
									type="email" class="form-control" id="inputEmail2" placeholder="Email" />
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-1 col-sm-10">
								<label id="usernameLabel" for="inputUsername2" class="val_error_label"></label> <input
									type="text" class="form-control" id="inputUsername2" placeholder="Username" />
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-1 col-sm-10">
								<label id="passwordLabel2" for="inputPassword2" class="val_error_label"></label> <input
									type="password" class="form-control" id="inputPassword2" placeholder="Password" />
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-1 col-sm-10">
								<label id="confirmLabel" for="inputConfirmPassword2" class="val_error_label"></label> <input
									type="password" class="form-control" id="inputConfirmPassword2"
									placeholder="Confirm Password" />
							</div>
						</div>
						<div class="col-sm-offset-1 col-sm-10">
							<div class="login_foot">
								<label> <a href="#" onclick="loginpop();">Login</a>
								</label>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<button type="button" onclick="createAccount();" class="btn btn-primary">Create
						Account</button>
				</div>
			</div>
		</div>
	</div>

	<div class="modal fade" id="aboutModal" style="z-index: 1000000">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal">&times;</button>
					<h5 class="modal-title">About Datanium</h5>
				</div>
				<div class="modal-body">

					<div class="about_desc">
						<div class="about_logo">
							<img src="./img/favicon32.ico"></img>
						</div>
						<div>
							<h5>Datanium - Version 0.1.334</h5>
							<h5>A platform that help you find, present, share and play with data.</h5>
						</div>
					</div>
					<div class="about_foot">
						Fork us on <a href="https://github.com/datanium/datanium">Github</a> or Contact us directly -
						<a href="mailto:admin@dtnium.com">dtnium@gmail.com</a>
					</div>

				</div>
			</div>
		</div>
	</div>

	<script src="./js/classie.js"></script>
	<script src="./js/gnmenu.js"></script>
	<script>
		$(document).ready(function() {
			var ieVersion = getIEVersion();
			if (ieVersion > 0 && ieVersion < 9)
				window.setTimeout(ieVersionPop, 1000);
			adjustScreenHeight();
			console.log(loginUsername);
			if (loginUsername != null && loginUsername != '')
				showUser(loginUsername);
		});

		new gnMenu(document.getElementById('gn-menu'));

		function adjustScreenHeight() {
			var heightOffset = 125;
			var appCon = document.getElementById('appContainer');
			appCon.style.height = (window.innerHeight - heightOffset) + 'px';
			window.onresize = function() {
				appCon.style.height = (window.innerHeight - heightOffset) + 'px';
			}
		}

		var login = function() {
			if (!validateLogin())
				return false;
			var link = '/login';
			$.ajax({
				url : link,
				type : 'POST',
				dataType : 'json',
				data : {
					email : $('#inputEmail').val(),
					password : $('#inputPassword').val(),
				},
				success : function(map) {
					if (map.status == 'login_success') {
						showUser(map.username);
						$('#loginModal').modal('hide');
					} else {
						if (map.status == 'email_not_exist') {
							$('#emailLabel').text(map.message);
							$('#emailLabel').show();
						} else {
							$('#emailLabel').hide();
						}
						if (map.status == 'password_not_match') {
							$('#passwordLabel').text(map.message);
							$('#passwordLabel').show();
						} else {
							$('#passwordLabel').hide();
						}
					}
				},
				error : function() {
					console.log(error);
				}
			});
		}

		var createAccount = function() {
			if (!validateSignUp())
				return false;
			var link = '/signup';
			$.ajax({
				url : link,
				type : 'POST',
				dataType : 'json',
				data : {
					username : $('#inputUsername2').val(),
					password : $('#inputPassword2').val(),
					email : $('#inputEmail2').val()
				},
				success : function(map) {
					if (map.status == 'create_user_success') {
						showUser(map.username);
						$('#signupModal').modal('hide');
					} else {
						if (map.status == 'email_exists') {
							$('#emailLabel2').text(map.message);
							$('#emailLabel2').show();
						} else {
							$('#emailLabel2').hide();
						}
						if (map.status == 'username_exists') {
							$('#usernameLabel2').text(map.message);
							$('#usernameLabel2').show();
						} else {
							$('#usernameLabel2').hide();
						}
						if (map.status == 'create_user_fail') {
							console.log('Server Error');
						}
						$('#inputPassword2').val('');
						$('#inputConfirmPassword2').val('');
					}

				},
				error : function() {
					console.log(error);
				}
			});
		}

		var validateSignUp = function() {
			var email = $('#inputEmail2').val();
			var username = $('#inputUsername2').val();
			var password = $('#inputPassword2').val();
			var confirmPassword = $('#inputConfirmPassword2').val();
			var count = 0;
			if (email == null || email == '') {
				$('#emailLabel2').text("This field is required.");
				$('#emailLabel2').show();
				count++;
			} else {
				$('#emailLabel2').hide();
			}
			if (username == null || username == '') {
				$('#usernameLabel').text("This field is required.");
				$('#usernameLabel').show();
				count++;
			} else {
				$('#usernameLabel').hide();
			}
			if (password == null || password == '') {
				$('#passwordLabel2').text("This field is required.");
				$('#passwordLabel2').show();
				count++;
			} else {
				$('#passwordLabel2').hide();
			}
			if (confirmPassword == null || confirmPassword == '') {
				$('#confirmLabel').text("This field is required.");
				$('#confirmLabel').show();
				count++;
			} else {
				$('#confirmLabel').hide();
			}
			if (password != null && password.length < 6) {
				$('#passwordLabel2').text(
						"Ensure this value has at least 6 characters (it has " + password.length + ").");
				$('#passwordLabel2').show();
				count++;
			}
			if (password != null && password != '' && confirmPassword != null && confirmPassword != ''
					&& password != confirmPassword) {
				$('#confirmLabel').text("The two password fields didn't match.");
				$('#confirmLabel').show();
				$('#inputPassword2').val('');
				$('#inputConfirmPassword2').val('');
				count++;
			}
			if (count > 0) {
				$('#inputPassword2').val('');
				$('#inputConfirmPassword2').val('');
				return false;
			}
			return true;
		}

		var validateLogin = function() {
			var email = $('#inputEmail').val();
			var password = $('#inputPassword').val();
			var count = 0;
			if (email == null || email == '') {
				$('#emailLabel').text("This field is required.");
				$('#emailLabel').show();
				count++;
			} else {
				$('#emailLabel').hide();
			}
			if (password == null || password == '') {
				$('#passwordLabel').text("This field is required.");
				$('#passwordLabel').show();
				count++;
			} else {
				$('#passwordLabel').hide();
			}
			if (count > 0) {
				return false;
			}
			return true;
		}

		var showModal = function() {
			showTxtModal('Search Indicator by Topic', 'Processing...');
			var link = '/rest/query/topicSearch';
			$.ajax({
				url : link,
				type : 'get',
				dataType : 'json',
				success : function(map) {
					var html = '';
					if (map.length > 0) {
						//alert(1);
						html = '<div class="panel-group" id="accordion">';
						$.each(map, function(index, item) {
							html += createCollapse(index, item);
							//html+='<p></p>';
						});
						html += '</div>';
					}
					updateTxtModal(null, '', html);
					$('#txtmodal').find('.modal-body #accordion').find('div[id^="collapse"]').collapse('hide');
				},
				error : function() {

				}
			});

		}

		function createCollapse(index, item) {
			var topic = item.topic;
			if (topic === '')
				return '';
			var indicator = item.indicatorText;
			var indicatorKey = item.indicatorKey;
			var html = '';
			html = '<div class="panel panel-default">';
			html += '<div class="panel-heading">';
			html += '<h4 class="panel-title">';
			html += '<a data-toggle="collapse" data-parent="#accordion" href="#collapse'+index+'">';
			html += topic;
			html += '</a>';
			html += '</h4>';
			html += '</div>';
			html += '<div id="collapse'+index+'" class="panel-collapse collapse in">';
			html += '<div class="panel-body">';
			if (indicator.length > 0) {
				$.each(indicator, function(indicatorTextIndex, indicatorTextStr) {
					var key = '';
					$.each(indicatorKey, function(indicatorKeyIndex, indicatorKeyStr) {
						if (indicatorTextIndex == indicatorKeyIndex) {
							key = indicatorKeyStr;
							return false;
						} else {
							return;
						}
					});
					html += '<p><a href="#" onclick="addIndicator(\'' + key + '\');">';
					html += indicatorTextStr;
					html += '</a></p>';
				});
			}
			html += '</div>';
			html += '</div>';
			html += '</div>';
			return html;
		}

		var comingSoon = function() {
			showTxtModal('&nbsp;', 'Coming Soon...', 'small');
		}

		var ieVersionPop = function() {
			$('#ieversion').modal('show');
		}

		var getIEVersion = function() {
			var ua = window.navigator.userAgent;
			var ie = ua.indexOf("MSIE ");
			return ((ie > 0) ? parseInt(ua.substring(ie + 5, ua.indexOf(".", ie))) : 0);
		}

		var saveSuccess = function() {
			showTxtModal('&nbsp;', 'Save Successful.', 'small');
		}

		var mySpace = function() {
			console.log('My Space');
		}

		var about = function() {
			$('#aboutModal').modal('show');
		}

		var loginpop = function() {
			setTimeout(function() {
				$('#inputEmail').focus();
			}, 500);
			$('#signupModal').modal('hide');
			$('#loginModal').modal('show');
			$("#loginModal").keypress(function(e) {
				if (e.keyCode == 13) {
					login();
				}
			});
		}

		var signuppop = function() {
			setTimeout(function() {
				$('#inputEmail2').focus();
			}, 500);
			$('#loginModal').modal('hide');
			$('#signupModal').modal('show');
			$("#signupModal").keypress(function(e) {
				if (e.keyCode == 13) {
					createAccount();
				}
			});
			//clearValues();
			//clearLabels();
		}

		var clearValues = function() {
			$('#inputEmail2').val('');
			$('#inputUsername2').val('');
			$('#inputPassword2').val('');
			$('#inputConfirmPassword2').val('');
		}

		var clearLabels = function() {
			$('#emailLabel').hide();
			$('#usernameLabel').hide();
			$('#passwordLabel').hide();
			$('#confirmLabel').hide();
		}

		var showTxtModal = function(title, content, size, html) {
			$('#txtmodaltitle').html('');
			$('#txtmodalbody').html('');
			$('#txtmodalhtmlbody').html('');
			$('#txtmodaldialog').attr('class', 'modal-dialog');
			if (size === 'small')
				$('#txtmodaldialog').attr('class', 'modal-dialog modal-sm');
			else if (size === 'large')
				$('#txtmodaldialog').attr('class', 'modal-dialog modal-lg');
			$('#txtmodaltitle').html(title);
			$('#txtmodalbody').html(content);
			$('#txtmodalhtmlbody').html(html);
			$('#txtmodal').modal('show');
		}

		var updateTxtModal = function(title, content, html) {
			if (title !== null)
				$('#txtmodaltitle').html(title);
			if (content !== null)
				$('#txtmodalbody').html(content);
			if (html !== null)
				$('#txtmodalhtmlbody').html(html);
		}

		var save = function() {
			var url = '/rest/save';
			$.ajax({
				type : 'POST',
				url : url,
				data : {
					hashid : Datanium.GlobalData.hashid,
					queryParam : Datanium.GlobalData.queryParam,
					qubeInfo : Datanium.GlobalData.qubeInfo,
					rptMode : Datanium.GlobalData.rptMode,
					chartMode : Datanium.GlobalData.chartMode
				},
				success : function(data) {
					if (Datanium.GlobalData.hashid === null || Datanium.GlobalData.hashid === '')
						window.location.href = window.location.protocol + "//" + window.location.host + '/'
								+ data.hashid;
					else
						saveSuccess();
				},
				error : function() {
				},
				dataType : 'json'
			});
		}

		var addIndicator = function(key) {
			Datanium.controller.Homepage.prototype.addIndicator(key);
			$('#txtmodal').modal('hide');
		}

		var showUser = function(username) {
			$('#userLink').attr('onclick', 'mySpace();');
			$('#userLabel').text(' ' + username);
		}

		$('#gnsearch').bind("enterKey", function(e) {
			showTxtModal('Data Indicator Search', 'Processing...');
			var searchKey = $('#gnsearch').val();
			var url = '/rest/indicator/search';
			$.ajax({
				type : 'GET',
				url : url,
				data : {
					query : searchKey
				},
				success : function(data) {
					var html = '';
					var indicators = data.indicators;
					if (indicators != null) {
						indicators.forEach(function(rec) {
							html += '<p><a href="#" onclick="addIndicator(\'' + rec.uniqueName + '\');">';
							html += rec.text;
							html += '</a></p>';
						});
						updateTxtModal(null, '', html);
					}
				},
				error : function() {
				},
				dataType : 'json'
			});
		});

		$('#gnsearch').keyup(function(e) {
			if (e.keyCode == 13) {
				$(this).trigger("enterKey");
			}
		});
	</script>
	<script>
		/* Google Analytics Tracking Code*/
		(function(i, s, o, g, r, a, m) {
			i['GoogleAnalyticsObject'] = r;
			i[r] = i[r] || function() {
				(i[r].q = i[r].q || []).push(arguments)
			}, i[r].l = 1 * new Date();
			a = s.createElement(o), m = s.getElementsByTagName(o)[0];
			a.async = 1;
			a.src = g;
			m.parentNode.insertBefore(a, m)
		})(window, document, 'script', '//www.google-analytics.com/analytics.js', 'ga');
		ga('create', 'UA-54110354-1', 'auto');
		ga('send', 'pageview');
	</script>
</body>
</html>